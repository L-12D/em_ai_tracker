;;; journal-manager.el --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–º –¥–Ω–µ–≤–Ω–∏–∫–æ–º —á–µ—Ä–µ–∑ org-journal -*- lexical-binding: t; -*-

;; –≠—Ç–æ—Ç –º–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ–º –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –∑–∞–º–µ—Ç–æ–∫ –≤ –¥–Ω–µ–≤–Ω–∏–∫–µ.
;; –ú—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º `org-journal-new-entry`, —á—Ç–æ–±—ã –≤—Ä—É—á–Ω—É—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É.
;; –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ Emacs —Å–∞–º —Å–æ–∑–¥–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–Ω–µ–≤–Ω–∏–∫–∞ –∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é.
;; –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å org-agenda.

;; ------------------------------
;; ‚öôÔ∏è  –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
;; ------------------------------
;; C-c j     ‚Äî –û—Ç–∫—Ä—ã—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –¥–Ω–µ–≤–Ω–∏–∫ –∑–∞ —Å–µ–≥–æ–¥–Ω—è (my/journal-open-today)
;;
;; üßæ –í–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª–∞:
;; - * –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ ‚Üí —à–æ—Ä—Ç-–∫–∞—Ç—ã ‚Äî C-c m

;;; üìé –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤ / –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤ –∫–æ–Ω—Ñ–∏–≥–æ–≤
;; –ß—Ç–æ–±—ã –≤–∞—à–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª–∞—Å—å –º–æ–∏–º –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–º —Å–ª–æ–≤–∞—Ä—è —à–æ—Ä—Ç–∫–∞—Ç–æ–≤:
;; (global-set-key (kbd "C-c j") #'my/journal-open-today) ;; –æ—Ç–∫—Ä—ã—Ç—å –¥–Ω–µ–≤–Ω–∏–∫

;;; –ö–æ–¥:

(require 'org)
(require 'org-journal)

;; ------------------------------
;; 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω–æ –∑–¥–µ—Å—å
;; ------------------------------

;; –Ø–≤–Ω–æ –∑–∞–¥–∞—ë–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Ñ–∞–π–ª–æ–≤ –¥–Ω–µ–≤–Ω–∏–∫–∞
(setq org-journal-dir "E:/YandexDisk/2 area/10 Emacs/New managment emacs/journal/")

;; –§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é YYYYMMDD)
(setq org-journal-file-format "%Y%m%d.org")

;; –û—Ç–∫–ª—é—á–∞–µ–º –≤—Å—Ç–∞–≤–∫—É –∞–≤—Ç–æ–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
(setq org-journal-file-header nil)

;; –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å org-agenda (—á—Ç–æ–±—ã –∑–∞–¥–∞—á–∏ –∏–∑ –¥–Ω–µ–≤–Ω–∏–∫–∞ –ø–æ–ø–∞–¥–∞–ª–∏ –≤ –ø–æ–≤–µ—Å—Ç–∫—É)
(setq org-journal-enable-agenda-integration t)

;; –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –±—ç–∫–∞–ø–æ–≤, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å ACL-–ø—Ä–æ–±–ª–µ–º
(setq backup-directory-alist `(("." . "~/.emacs.d/backups")))

;; –¢–∞–∫–∂–µ –¥–æ–±–∞–≤–∏–º journal-dir –≤ org-agenda-files, –µ—Å–ª–∏ –æ–Ω –µ—â—ë –Ω–µ —Ç–∞–º
(unless (member org-journal-dir org-agenda-files)
  (add-to-list 'org-agenda-files org-journal-dir))


;; ------------------------------
;; 2. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞
;; ------------------------------

(defun my/journal-open-today ()
  "–û—Ç–∫—Ä—ã—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –¥–Ω–µ–≤–Ω–∏–∫ –∑–∞ —Å–µ–≥–æ–¥–Ω—è.
–°–æ–∑–¥–∞—ë—Ç —Ñ–∞–π–ª —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º, —Å–µ–∫—Ü–∏–µ–π * –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∏ * Notes, –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç."
  (interactive)
  (let* ((filename (format-time-string org-journal-file-format))
         (full-path (expand-file-name filename org-journal-dir)))
    ;; –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    (unless (file-directory-p org-journal-dir)
      (make-directory org-journal-dir t))
    (if (file-exists-p full-path)
        (find-file full-path)
      (find-file full-path)
      (insert (format "#+title: %s\n\n" (format-time-string "%A, %d %B %Y")))
      (insert "* –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫\n:PROPERTIES:\n:VISIBILITY: folded\n:END:\n"
              "- —à–æ—Ä—Ç-–∫–∞—Ç—ã ‚Äî C-c m\n\n"
              "* Notes\n")
      (save-buffer)
      (message "–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –¥–Ω–µ–≤–Ω–∏–∫ –∑–∞ —Å–µ–≥–æ–¥–Ω—è"))))

(global-set-key (kbd "C-c j") #'my/journal-open-today) ;; –æ—Ç–∫—Ä—ã—Ç—å –¥–Ω–µ–≤–Ω–∏–∫

(provide 'journal-manager)

;;; journal-manager.el ends here
